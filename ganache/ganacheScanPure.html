<!DOCTYPE html>
<html lang="en">

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <title>Ganache Scan-Pure</title>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <script type="text/javascript" src="./bignumber.min.js"></script>
    <script type="text/javascript" src="./web3.js"></script>

    <script type="text/javascript">
        if (typeof web3 !== "undefined") {
            web3 = new Web3(web3.currentProvider);
        } else {
            // set the provider you want from Web3.providers
            web3 = new Web3(
                new Web3.providers.HttpProvider("http://localhost:8545")
            );
        }

        console.log(web3);

        if (web3.isConnected()) {
            console.log("connected");
        } else {
            console.log("not connected");
        }

        let accounts = web3.eth.accounts;
        console.log(accounts);

        let balance = web3.eth.getBalance(accounts[0]);
        console.log(web3.fromWei(balance).toNumber() + "ETH");

        for (var i = 0; i < accounts.length; i++) {
            document.getElementById().innerHTML = accounts[i];
            document.getElementById().innerHTML =
                web3.fromWei(web3.eth.getBalance(accounts[i])).toNumber() + "ETH";
        }

        function table() {
            var h = [];
            for (var address of accounts) {
                h.push("<tr>");
                h.push("<td>" + address + "</td>");
                h.push(
                    "<td>" +
                    web3.fromWei(web3.eth.getBalance(address)).toNumber() +
                    "ETH" +
                    "</td>"
                );

                h.push("</tr>");
            }

            document.getElementById("tb").innerHTML = h.join("");
        }

        function sendETH() {
            let from = document.getElementById("accountFrom").value;
            console.log();
            let to = document.getElementById("accountTo").value;
            let ethValue = document.getElementById("amountETH").value;
            let txhash = web3.eth.sendTransaction({
                from: from,
                to: to,
                value: web3.toWei(ethValue, "ether"),
            });
            console.log(typeof txhash);
            document.getElementById("txHash").value = txhash;
            table();
            getTrxDetail()



        }

        function getBlockDetail() {
            var D = [];
            let num = document.getElementById("blockNum").value;

            web3.eth.getBlock(num, function (error, block) {
                console.log(block);
                for (i in block) {
                    D.push("<tr>");

                    D.push("<td>" + i + "</td>");
                    D.push("<td>" + block[i] + "</td>");

                    D.push("</tr>");
                }
                document.getElementById("BD").innerHTML = D.join("");
            });
        }

        function getTrxDetail() {
            var T = [];
            let trxHash = document.getElementById("txHash").value;

            web3.eth.getTransaction(trxHash, function (error, tx) {
                console.log(tx);
                for (j in tx) {
                    T.push("<tr>");

                    T.push("<td>" + j + "</td>");
                    T.push("<td>" + tx[j] + "</td>");

                    T.push("</tr>");
                }
                document.getElementById("trx").innerHTML = T.join("");
            });
        }

        function createAccount() {
            let pwd = document.getElementById("PW").value;
            web3.personal.newAccount(pwd);

        }

        function identifyInput() {

            let input = document.getElementById("search_input").value;
            console.log(input);

            if (input.length === 66) {
                let T = []
                web3.eth.getTransaction(input, function (error, tx) {
                    console.log(tx);
                    T.push("<table>")
                    T.push("<th colspan=\"2\">" + "Transaction Detail" + "</th>")
                    for (j in tx) {
                        T.push("<tr>");

                        T.push("<td>" + j + "</td>");
                        T.push("<td>" + tx[j] + "</td>");

                        T.push("</tr>");
                    }
                    document.getElementById("scan_result").innerHTML = T.join("");
                });
            } else if (input.length === 42) {
                document.getElementById("scan_result").innerHTML = "  Balance : " +
                    web3.fromWei(web3.eth.getBalance(input)).toNumber() +
                    "  ETH"

            } else if (typeof input == 'string') {
                let D = [];
                web3.eth.getBlock(input, function (error, block) {
                    console.log(block);
                    D.push("<table>")
                    D.push("<th colspan=\"2\">" + "Block Detail" + "</th>")

                    for (i in block) {
                        D.push("<tr>");

                        D.push("<td>" + i + "</td>");
                        D.push("<td>" + block[i] + "</td>");

                        D.push("</tr>");
                    }
                    D.push("</table>")
                    document.getElementById("scan_result").innerHTML = D.join("");
                });
            }

        }
    </script>



    <title>Document</title>
</head>

<body>
    <div>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">Ganache Scan</a>

        </nav>
        <header class="bg-primary bg-gradient text-white">
            <div class="container px-4 text-center">
                <h1 class="fw-bolder mb-5">Welcome to Ganache Scan</h1>

                <div class="mb-5">
                    <input type="text" id="search_input" value="">
                    <button onclick="identifyInput()">Search</button>
                </div>
            </div>


        </header>

    </div>
    <div id="scan_result" class="row gx-4 justify-content-center">
    </div>

</body>
<style>
    table,
    th,
    tb {
        border-collapse: collapse;
        max-width: 736px;
    }

    table {
        width: 100%;
        max-width: 736px;
    }

    th,
    td {
        border: 1px solid #ddd;
        padding: 10px;
        max-width: 736px;
        word-break: break-all;
    }

    #scan_result {
        width: 800px;
        word-break: break-all;
        margin: auto
    }
</style>

</html>